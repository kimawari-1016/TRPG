<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>キャラクターシート</title>
  <style>
    body { font-family: sans-serif; padding: 10px; }
    .section { margin-bottom: 20px; }
    .field-row { display: flex; align-items: center; margin-bottom: 5px; }
    .field-row input[type="number"] { width: 60px; margin-left: 5px; }
    .label { width: 120px; }
    .btn { margin-left: 5px; }
    .subsection { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>キャラクターシート</h1>
  <div class="section">
    <strong>ステータスポイント: <span id="statPoints">250</span></strong>
  </div>  <div class="section">
    <h2>メインステータス</h2>
    <div id="mainStats"></div>
  </div>  <div class="section">
    <h2>戦闘ステータス</h2>
    <div id="combatStats"></div>
  </div>  <div class="section">
    <strong>スキルポイント: <span id="skillPoints">1000</span></strong>
  </div>  <div class="section">
    <h2>技能</h2>
    <div id="skills"></div>
    <button onclick="addSkill()">技能を追加</button>
  </div>  <div class="section">
    <h2>スキル</h2>
    <div id="customSkills"></div>
    <button onclick="addCustomSkill()">スキルを追加</button>
  </div>  <script>
    const mainStatList = ["体力", "筋力", "精神", "俊敏", "器用", "知力"];
    const combatStatList = ["HP", "MP", "装甲値", "速度", "後隙"];
    const fixedSkills = ["威圧", "交渉", "乗馬", "水泳", "登攀", "追跡", "知識", "芸術", "創作", "礼儀作法", "回避", "隠密"];

    let statPoints = 250;
    let skillPoints = 1000;
    const mainStats = {};
    const skillValues = {};

    function updatePoints() {
      document.getElementById("statPoints").innerText = statPoints;
      document.getElementById("skillPoints").innerText = skillPoints;
    }

    function renderStats(id, list, values, isStat = true) {
      const container = document.getElementById(id);
      container.innerHTML = "";
      list.forEach(name => {
        if (!values[name]) values[name] = { base: 30, extra: 0 };
        const total = values[name].base + values[name].extra;
        const row = document.createElement("div");
        row.className = "field-row";
        row.innerHTML = `
          <div class="label">${name}</div>
          <div>基礎値: ${values[name].base}</div>
          <div>割り振り: ${values[name].extra}</div>
          <button class="btn" onclick="increaseStat('${id}', '${name}', ${isStat})">＋</button>
        `;
        container.appendChild(row);
      });
    }

    function increaseStat(section, name, isStat) {
      const values = section === "mainStats" ? mainStats : skillValues;
      const total = values[name].base + values[name].extra;
      const cost = total >= 100 ? 2 : 1;

      if ((isStat ? statPoints : skillPoints) >= cost) {
        values[name].extra++;
        if (isStat) statPoints -= cost;
        else skillPoints -= cost;
        updatePoints();
        renderStats(section, Object.keys(values), values, isStat);
        if (section === "mainStats") calculateCombatStats();
      } else {
        alert("ポイントが足りません");
      }
    }

    function calculateCombatStats() {
      const c = {};
      c["HP"] = 60 + Math.floor((mainStats["体力"].base + mainStats["体力"].extra) * 1.5 / 5);
      c["MP"] = 30 + Math.floor((mainStats["精神"].base + mainStats["精神"].extra) * 0.4 / 5);
      c["装甲値"] = Math.floor((mainStats["筋力"].base + mainStats["筋力"].extra) / 20);
      c["速度"] = 20 + Math.floor((mainStats["俊敏"].base + mainStats["俊敏"].extra) / 10);
      c["後隙"] = Math.max(25 - Math.floor((mainStats["俊敏"].base + mainStats["俊敏"].extra) / 50), 0);

      const container = document.getElementById("combatStats");
      container.innerHTML = "";
      Object.entries(c).forEach(([name, value]) => {
        const row = document.createElement("div");
        row.className = "field-row";
        row.innerHTML = `<div class="label">${name}</div><div>${value}</div>`;
        container.appendChild(row);
      });
    }

    function addSkill() {
      const name = prompt("技能名を入力してください");
      if (!name || skillValues[name]) return;
      skillValues[name] = { base: 0, extra: 0 };
      renderStats("skills", Object.keys(skillValues), skillValues, false);
    }

    function addCustomSkill() {
      if (skillPoints < 100) return alert("スキルポイントが足りません");
      const container = document.getElementById("customSkills");
      const wrapper = document.createElement("div");
      wrapper.className = "subsection";
      wrapper.innerHTML = `
        <input placeholder="名前" />
        <input placeholder="効果" />
        <button onclick="this.parentElement.remove(); skillPoints += 100; updatePoints()">削除</button>
      `;
      container.appendChild(wrapper);
      skillPoints -= 100;
      updatePoints();
    }

    // 初期表示設定
    mainStatList.forEach(name => mainStats[name] = { base: 30, extra: 0 });
    fixedSkills.forEach(name => skillValues[name] = { base: 0, extra: 0 });
    renderStats("mainStats", mainStatList, mainStats);
    renderStats("skills", fixedSkills, skillValues, false);
    calculateCombatStats();
    updatePoints();
  </script></body>
</html>
