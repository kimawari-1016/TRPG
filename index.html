<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>キャラクター作成</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .section { margin-bottom: 20px; }
    .field { margin-bottom: 5px; }
    .stat-block, .skill-block, .ability-block, .skill-entry { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }
    input[type=number] { width: 60px; }
    button { padding: 4px 8px; }
  </style>
</head>
<body>
  <div class="section">
    <h2>メインステータス</h2>
    <div id="main-status"></div>
  </div>  <div class="section">
    <h2>戦闘ステータス</h2>
    <div id="combat-status"></div>
  </div>  <div class="section">
    <h2>スキルポイント: <span id="skill-points">1000</span></h2>
  </div>  <div class="section">
    <h2>技能</h2>
    <div id="skills"></div>
    <button onclick="addSkill()">技能を追加</button>
  </div>  <div class="section">
    <h2>スキル</h2>
    <div id="abilities"></div>
    <button onclick="addAbility()">スキルを追加</button>
  </div>  <script>
    const baseMainStats = {
      "体力": 30,
      "筋力": 30,
      "精神": 30,
      "俊敏": 30,
      "器用": 30,
      "知力": 30
    };

    const skillsList = [
      "威圧", "交渉", "乗馬", "水泳", "登攀", "追跡", "知識", "芸術", "創作", "礼儀作法", "回避", "隠密"
    ];

    let skillPoints = 1000;
    const skillData = {};
    const additionalSkills = [];
    const abilities = [];

    function updateSkillPoints() {
      document.getElementById("skill-points").textContent = skillPoints;
    }

    function calculateCost(current) {
      return current >= 100 ? 2 : 1;
    }

    function createStatBlock(name, value, onChange) {
      const block = document.createElement("div");
      block.className = "stat-block";

      const label = document.createElement("span");
      label.textContent = name + "（基礎値）: " + value;

      const input = document.createElement("input");
      input.type = "number";
      input.min = 0;
      input.value = 0;
      input.addEventListener("input", () => onChange(name, value, parseInt(input.value)));

      const allocationLabel = document.createElement("span");
      allocationLabel.textContent = "割り振り";

      block.appendChild(label);
      block.appendChild(allocationLabel);
      block.appendChild(input);

      return block;
    }

    function renderMainStats() {
      const container = document.getElementById("main-status");
      container.innerHTML = "";
      for (let [name, value] of Object.entries(baseMainStats)) {
        container.appendChild(createStatBlock(name, value, handleMainStatChange));
      }
    }

    function handleMainStatChange(name, base, value) {
      const total = base + value;
      let cost = 0;
      for (let i = 1; i <= value; i++) {
        cost += calculateCost(base + i - 1);
      }
      if (skillPoints + skillData[name] >= cost) {
        skillPoints = skillPoints + skillData[name] - cost;
        skillData[name] = cost;
        updateSkillPoints();
      } else {
        alert("スキルポイントが足りません");
      }
    }

    function renderCombatStats() {
      const container = document.getElementById("combat-status");
      container.innerHTML = "";
      for (let [name, value] of Object.entries(baseMainStats)) {
        container.appendChild(createStatBlock(name, value, handleMainStatChange));
      }
    }

    function addSkill(name = "", editable = true) {
      const block = document.createElement("div");
      block.className = "skill-block";

      const inputName = document.createElement("input");
      inputName.value = name;
      inputName.disabled = !editable;

      const inputValue = document.createElement("input");
      inputValue.type = "number";
      inputValue.min = 0;
      inputValue.value = 0;
      inputValue.addEventListener("input", () => {
        const value = parseInt(inputValue.value);
        let cost = 0;
        for (let i = 1; i <= value; i++) {
          cost += calculateCost(i - 1);
        }
        if (skillPoints + (skillData[name] || 0) >= cost) {
          skillPoints = skillPoints + (skillData[name] || 0) - cost;
          skillData[name] = cost;
          updateSkillPoints();
        } else {
          alert("スキルポイントが足りません");
        }
      });

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "削除";
      deleteBtn.addEventListener("click", () => {
        block.remove();
        skillPoints += skillData[name] || 0;
        delete skillData[name];
        updateSkillPoints();
      });

      block.appendChild(inputName);
      block.appendChild(inputValue);
      block.appendChild(deleteBtn);

      document.getElementById("skills").appendChild(block);
    }

    function addAbility() {
      if (skillPoints < 100) {
        alert("スキルポイントが足りません");
        return;
      }
      skillPoints -= 100;
      updateSkillPoints();

      const block = document.createElement("div");
      block.className = "ability-block";

      const nameInput = document.createElement("input");
      nameInput.placeholder = "スキル名";

      const effectInput = document.createElement("input");
      effectInput.placeholder = "効果";

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "削除";
      deleteBtn.addEventListener("click", () => {
        block.remove();
        skillPoints += 100;
        updateSkillPoints();
      });

      block.appendChild(nameInput);
      block.appendChild(effectInput);
      block.appendChild(deleteBtn);

      document.getElementById("abilities").appendChild(block);
    }

    function initialize() {
      renderMainStats();
      renderCombatStats();
      skillsList.forEach(skill => addSkill(skill, false));
      updateSkillPoints();
    }

    initialize();
  </script></body>
</html>
